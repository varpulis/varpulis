services:
  mosquitto:
    image: eclipse-mosquitto:2
    container_name: varpulis-managed-mqtt
    ports:
      - "11883:1883"
    volumes:
      - ./mosquitto-managed.conf:/mosquitto/config/mosquitto.conf
    healthcheck:
      test: ["CMD-SHELL", "mosquitto_sub -h localhost -p 1883 -t '$$SYS/#' -C 1 -W 1 || exit 1"]
      interval: 5s
      timeout: 3s
      retries: 5
      start_period: 2s
